<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.wthfeng.hfmusic.dao.form.FormDAO" >

    <!--获取歌单详情-->
    <resultMap id="getDetailsMap" type="top.wthfeng.hfmusic.model.view.ViewFormDetails">
        <id column="formId" property="formId"/>
        <result column="formName" property="formName"/>
        <result column="info" property="info"/>
        <result column="createTime" property="createTime" />
        <result column="creator" property="creator"/>
        <result column="collectNum" property="collcetNum"/>
        <result column="singerName" property="singerName"/>
        <collection property="labels" ofType="java.lang.String">
            <result column="label" />
        </collection>
        <collection property="musicList" ofType="top.wthfeng.hfmusic.model.music.SimpleMusic">
            <result property="musicId" column="musicId"/>
            <result property="musicName" column="musicName"/>
            <result property="album" column="album"/>
            <result property="singerName" column="singerName"/>
        </collection>
    </resultMap>

    <!--获取歌单详情-->
    <select id="getDetails" parameterType="java.lang.Integer"
            resultMap="getDetailsMap">
       SELECT f.id as formId,f.formName,f.info ,fl.labelName label,f.createTime,
  u.nickName creator,m.id musicId,
 (select count(fc.id) from form_collect fc  where fc.formId=f.id) as  collectNum,
 m.id as musicId,m.name as musicName,m.album,s.name as singerName
 from form f
  left join form_details fd on f.id=fd.formId
  LEFT JOIN music m on fd.musicId=m.id
  left join form_label fl on f.id=fl.formId
  left join user u on f.userId=u.id
 left join singer s on m.singerId=s.id
 where f.id=1

    </select>
</mapper>